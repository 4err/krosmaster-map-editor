function lineIntersect2(t,e,s,i,o,r,a,l){var n=((t*i-e*s)*(o-a)-(t-s)*(o*l-r*a))/((t-s)*(r-l)-(e-i)*(o-a)),c=((t*i-e*s)*(r-l)-(e-i)*(o*l-r*a))/((t-s)*(r-l)-(e-i)*(o-a));if(isNaN(n)||isNaN(c))return!1;if(t>=s){if(!(s<=n&&n<=t))return!1}else if(!(t<=n&&n<=s))return!1;if(e>=i){if(!(i<=c&&c<=e))return!1}else if(!(e<=c&&c<=i))return!1;if(o>=a){if(!(a<=n&&n<=o))return!1}else if(!(o<=n&&n<=a))return!1;if(r>=l){if(!(l<=c&&c<=r))return!1}else if(!(r<=c&&c<=l))return!1;return!0}function lineIntersect(t,e,s,i,o,r,a,l){var n=((t*i-e*s)*(o-a)-(t-s)*(o*l-r*a))/((t-s)*(r-l)-(e-i)*(o-a)),c=((t*i-e*s)*(r-l)-(e-i)*(o*l-r*a))/((t-s)*(r-l)-(e-i)*(o-a));if(isNaN(n)||isNaN(c))return!1;if(t>=s){if(!(s<=n&&n<=t))return!1}else if(!(t<=n&&n<=s))return!1;if(e>=i){if(!(i<=c&&c<=e))return!1}else if(!(e<=c&&c<=i))return!1;if(o>=a){if(!(a<=n&&n<=o))return!1}else if(!(o<=n&&n<=a))return!1;if(r>=l){if(!(l<=c&&c<=r))return!1}else if(!(r<=c&&c<=l))return!1;return!0}function CellBlock(t,e,s,i,o){this.cellTypes=default_settings.cellTypes,this.x=t||0,this.y=e||0,this.w=s||1,this.h=i||1,this.fill=o||"#ffffff",this.cell_x=-1,this.cell_y=-1,this.cellType=this.cellTypes.empty}function CanvasState(t,e,s,i){this.cell_size=e,this.cx=s,this.cy=i,this.settings=default_settings,this.matrix=new Array(s);for(var o=0;o<s;o++){this.matrix[o]=new Array(i);for(var r=0;r<i;r++)this.matrix[o][r]=0}this.drawDistance=!1,this.hiddenInvisible=!1,this.hero=new CellBlock(Math.floor(s/2)*this.cell_size,(i-1)*this.cell_size,this.cell_size,this.cell_size),this.hero.cell_x=Math.floor(s/2),this.hero.cell_y=i-1,this.matrix[Math.floor(s/2)][i-1]=2,this.hero.fill=this.settings.hero_color,this.hero.isMoving=!1,this.hero.cellType=this.settings.cellTypes.hero,this.canvas=t,this.width=t.width,this.height=t.height,this.ctx=t.getContext("2d");document.defaultView&&document.defaultView.getComputedStyle&&(this.stylePaddingLeft=parseInt(document.defaultView.getComputedStyle(t,null).paddingLeft,10)||0,this.stylePaddingTop=parseInt(document.defaultView.getComputedStyle(t,null).paddingTop,10)||0,this.styleBorderLeft=parseInt(document.defaultView.getComputedStyle(t,null).borderLeftWidth,10)||0,this.styleBorderTop=parseInt(document.defaultView.getComputedStyle(t,null).borderTopWidth,10)||0);var a=document.body.parentNode;this.htmlTop=a.offsetTop,this.htmlLeft=a.offsetLeft,this.valid=!1,this.obstructives=[],this.dragging=!1,this.selection=null,this.dragoffx=0,this.dragoffy=0;var l=this;t.addEventListener("selectstart",function(t){return t.preventDefault(),!1},!1),t.addEventListener("dblclick",function(t){return!1},!1),t.addEventListener("click",function(t){l.mouseHandler(t,"addObstructive")},!0),this.selectionColor="#CC0000",this.selectionWidth=2,this.interval=30,setInterval(function(){l.draw()},l.interval)}function Start(){cs=new CanvasState(document.getElementById("los"),69,12,12)}function clearSight(){cs?cs.resetObstructives():Start()}function showDistance(t){cs&&(cs.drawDistance=t,cs.valid=!1)}function toggleDistance(){cs&&(cs.drawDistance=!cs.drawDistance,cs.valid=!1)}function toggleInvisible(){cs&&(cs.hiddenInvisible=!cs.hiddenInvisible,cs.valid=!1)}function moveHero(){cs.hero.isMoving=!0,cs.hero.fill="#000000",cs.valid=!1}function loadMap(t){maps_obstructives[t]&&cs.loadMap(maps_obstructives[t])}("function"!=typeof Blob&&"object"!=typeof Blob||"undefined"==typeof URL)&&(self.Blob=function(t){"use strict";t.URL=t.URL||t.webkitURL;var e=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder||function(t){var e=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},s=function(){this.data=[]},i=function(t,e,s){this.data=t,this.size=t.length,this.type=e,this.encoding=s},o=s.prototype,r=i.prototype,a=t.FileReaderSync,l=function(t){this.code=this[this.name=t]},n="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=n.length,h=t.URL||t.webkitURL||t,d=h.createObjectURL,u=h.revokeObjectURL,f=h,p=t.btoa,v=t.atob,g=t.ArrayBuffer,m=t.Uint8Array;for(i.fake=r.fake=!0;c--;)l.prototype[n[c]]=c+1;return h.createObjectURL||(f=t.URL={}),f.createObjectURL=function(t){var e,s=t.type;return null===s&&(s="application/octet-stream"),t instanceof i?(e="data:"+s,"base64"===t.encoding?e+";base64,"+t.data:"URI"===t.encoding?e+","+decodeURIComponent(t.data):p?e+";base64,"+p(t.data):e+","+encodeURIComponent(t.data)):d?d.call(h,t):void 0},f.revokeObjectURL=function(t){"data:"!==t.substring(0,5)&&u&&u.call(h,t)},o.append=function(t){var s=this.data;if(m&&(t instanceof g||t instanceof m)){for(var o="",r=new m(t),n=0,c=r.length;n<c;n++)o+=String.fromCharCode(r[n]);s.push(o)}else if("Blob"===e(t)||"File"===e(t)){if(!a)throw new l("NOT_READABLE_ERR");var h=new a;s.push(h.readAsBinaryString(t))}else t instanceof i?"base64"===t.encoding&&v?s.push(v(t.data)):"URI"===t.encoding?s.push(decodeURIComponent(t.data)):"raw"===t.encoding&&s.push(t.data):("string"!=typeof t&&(t+=""),s.push(unescape(encodeURIComponent(t))))},o.getBlob=function(t){return arguments.length||(t=null),new i(this.data.join(""),t,"raw")},o.toString=function(){return"[object BlobBuilder]"},r.slice=function(t,e,s){var o=arguments.length;return o<3&&(s=null),new i(this.data.slice(t,o>1?e:this.data.length),s,this.encoding)},r.toString=function(){return"[object Blob]"},s}(t);return function(t,s){var i=s?s.type||"":"",o=new e;if(t)for(var r=0,a=t.length;r<a;r++)o.append(t[r]);return o.getBlob(i)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this)),function(t){"use strict";var e,s=t.Uint8Array,i=t.HTMLCanvasElement,o=i&&i.prototype,r=/\s*;\s*base64\s*(?:;|$)/i,a="toDataURL",l=function(t){for(var i,o,r=t.length,a=new s(r/4*3|0),l=0,n=0,c=[0,0],h=0,d=0;r--;)o=t.charCodeAt(l++),255!==(i=e[o-43])&&void 0!==i&&(c[1]=c[0],c[0]=o,d=d<<6|i,4===++h&&(a[n++]=d>>>16,61!==c[1]&&(a[n++]=d>>>8),61!==c[0]&&(a[n++]=d),h=0));return a};s&&(e=new s([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),i&&!o.toBlob&&(o.toBlob=function(t,e){if(e||(e="image/png"),this.mozGetAsFile)return void t(this.mozGetAsFile("canvas",e));var i,o=Array.prototype.slice.call(arguments,1),n=this[a].apply(this,o),c=n.indexOf(","),h=n.substring(c+1),d=r.test(n.substring(0,c));Blob.fake?(i=new Blob,i.encoding=d?"base64":"URI",i.data=h,i.size=h.length):s&&(i=d?new Blob([l(h)],{type:e}):new Blob([decodeURIComponent(h)],{type:e})),t(i)},o.toDataURLHD?o.toBlobHD=function(){a="toDataURLHD";var t=this.toBlob();return a="toDataURL",t}:o.toBlobHD=o.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,s=function(){return t.URL||t.webkitURL||t},i=t.URL||t.webkitURL||t,o=e.createElementNS("http://www.w3.org/1999/xhtml","a"),r=!t.externalHost&&"download"in o,a=t.webkitRequestFileSystem,l=t.requestFileSystem||a||t.mozRequestFileSystem,n=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},c=0,h=[],d=function(){for(var t=h.length;t--;){var e=h[t];"string"==typeof e?i.revokeObjectURL(e):e.remove()}h.length=0},u=function(t,e,s){e=[].concat(e);for(var i=e.length;i--;){var o=t["on"+e[i]];if("function"==typeof o)try{o.call(t,s||t)}catch(t){n(t)}}},f=function(i,n){var d,f,p,v=this,g=i.type,m=!1,b=function(){var t=s().createObjectURL(i);return h.push(t),t},y=function(){u(v,"writestart progress write writeend".split(" "))},w=function(){!m&&d||(d=b()),f?f.location.href=d:window.open(d,"_blank"),v.readyState=v.DONE,y()},C=function(t){return function(){if(v.readyState!==v.DONE)return t.apply(this,arguments)}},k={create:!0,exclusive:!1};if(v.readyState=v.INIT,n||(n="download"),r){d=b(),e=t.document,o=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o.href=d,o.download=n;var _=e.createEvent("MouseEvents");return _.initMouseEvent("click",!0,!1,t,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(_),v.readyState=v.DONE,void y()}if(t.chrome&&g&&"application/octet-stream"!==g&&(p=i.slice||i.webkitSlice,i=p.call(i,0,i.size,"application/octet-stream"),m=!0),a&&"download"!==n&&(n+=".download"),("application/octet-stream"===g||a)&&(f=t),!l)return void w();c+=i.size,l(t.TEMPORARY,c,C(function(t){t.root.getDirectory("saved",k,C(function(t){var e=function(){t.getFile(n,k,C(function(t){t.createWriter(C(function(e){e.onwriteend=function(e){f.location.href=t.toURL(),h.push(t),v.readyState=v.DONE,u(v,"writeend",e)},e.onerror=function(){var t=e.error;t.code!==t.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(t){e["on"+t]=v["on"+t]}),e.write(i),v.abort=function(){e.abort(),v.readyState=v.DONE},v.readyState=v.WRITING}),w)}),w)};t.getFile(n,{create:!1},C(function(t){t.remove(),e()}),C(function(t){t.code===t.NOT_FOUND_ERR?e():w()}))}),w)}),w)},p=f.prototype,v=function(t,e){return new f(t,e)};return p.abort=function(){var t=this;t.readyState=t.DONE,u(t,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,t.addEventListener("unload",d,!1),v.unload=function(){d(),t.removeEventListener("unload",d,!1)},v}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs});var cs=null,maps_obstructives={bonta1:[[3,3],[10,4],[6,5],[5,6],[1,7],[8,8]],bonta1_tapped:[[4,1],[8,3],[7,10],[3,8],[6,6],[5,5]],bonta2:[[3,2],[6,3],[9,5],[8,9],[5,8],[2,6]],bonta2_tapped:[[5,2],[9,3],[8,6],[3,5],[2,8],[6,9]]},default_settings={hero_color:"#0080ff",hero_selected_color:"#000000",selectionColor:"#CC0000",strokeColor:"#2AAE61",distanceFillColor:"#FFFFFF",obstructiveColor:"rgba(206,59,85,0.5)",invisibleObstructiveColor:"#F3AC3F",gridStrokeColor:"#cccccc",cellTypes:{empty:0,obstructive:1,hero:2}};CellBlock.prototype.draw=function(t){if(this.cellType==this.cellTypes.hero){t.beginPath();var e=t.lineWidth,s=t.strokeStyle;t.lineWidth=6,t.strokeStyle=this.fill,t.arc(this.x+Math.floor(this.w/2),this.y+Math.floor(this.h/2),Math.floor(this.w/2)-3,0,2*Math.PI,!1),t.stroke(),t.lineWidth=e,t.strokeStyle=s,t.closePath()}else t.fillStyle=this.fill,t.fillRect(this.x,this.y,this.w,this.h)},CellBlock.prototype.intersectLine=function(t,e,s,i){var o=this.x+1,r=this.y+1,a=this.w-2,l=this.h-2,n=lineIntersect(o,r,o+a,r,t,e,s,i),c=lineIntersect(o,r,o,r+l,t,e,s,i),h=lineIntersect(o+a,r,o+a,r+l,t,e,s,i),d=lineIntersect(o,r+l,o+a,r+l,t,e,s,i);return n||c||h||d},CellBlock.prototype.contains=function(t,e){return this.x<=t&&this.x+this.w>=t&&this.y<=e&&this.y+this.h>=e},CanvasState.prototype.resetObstructives=function(){for(var t=this.obstructives.length,e=t-1;e>=0;e--)this.matrix[this.obstructives[e].cell_x][this.obstructives[e].cell_y]=0,this.obstructives.splice(e,1);this.valid=!1},CanvasState.prototype.addObstructiveBlock=function(t,e,s){if(console.log(t,e),this.matrix[t][e]==this.settings.cellTypes.obstructive){for(var i=this.obstructives.length,o=i-1;o>=0;o--)if(console.log(this.obstructives[o]),this.obstructives[o].cell_x==t&&this.obstructives[o].cell_y==e)return this.matrix[this.obstructives[o].cell_x][this.obstructives[o].cell_y]=this.settings.cellTypes.empty,this.obstructives.splice(o,1),void(this.valid=!1)}else this.matrix[t][e]==this.settings.cellTypes.empty?this.hero.isMoving?this.moveHero(t,e):(obstructive=new CellBlock(t*this.cell_size,e*this.cell_size,this.cell_size,this.cell_size,this.settings.obstructiveColor),obstructive.cell_x=t,obstructive.cell_y=e,this.obstructives.push(obstructive),this.matrix[t][e]=this.settings.cellTypes.obstructive,this.valid=!1):this.matrix[t][e]!=this.settings.cellTypes.hero||s||(this.hero.fill=this.settings.hero_selected_color,this.hero.isMoving=!0,this.valid=!1)},CanvasState.prototype.removeObstructiveBlock=function(t,e){if(this.matrix[t][e]==this.settings.cellTypes.obstructive)for(var s=this.obstructives.length,i=s-1;i>=0;i--)if(this.obstructives[i].cell_x==t&&this.obstructives[i].cell_y==e)return this.matrix[this.obstructives[i].cell_x][this.obstructives[i].cell_y]=this.settings.cellTypes.empty,this.obstructives.splice(i,1),void(this.valid=!1)},CanvasState.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},CanvasState.prototype.draw=function(){if(!this.valid){var t=this.ctx,e=this.obstructives;this.clear(),this.MakeGrid(this.cell_size,this.cx,this.cy);for(var s=e.length,i=0;i<s;i++){var o=e[i];o.x>this.width||o.y>this.height||o.x+o.w<0||o.y+o.h<0||e[i].draw(t)}if(this.hero){this.hero.draw(t);for(var r=this.hero.x+Math.floor(this.hero.w/2),a=this.hero.y+Math.floor(this.hero.h/2),i=0;i<this.cx;i++)for(var l=0;l<this.cy;l++)if(0==this.matrix[i][l]){for(var n=i*this.cell_size+Math.floor(this.cell_size/2),c=l*this.cell_size+Math.floor(this.cell_size/2),h=e.length,d=!1,h=0;h<s;h++)d=d||e[h].intersectLine(r,a,n,c);var u=Math.abs(this.hero.cell_x-i)+Math.abs(this.hero.cell_y-l);if(!d||this.hiddenInvisible){var f=i*this.cell_size+3,p=l*this.cell_size+3,v=this.cell_size-6;t.beginPath(),t.rect(f,p,v,v),t.strokeStyle=this.settings.strokeColor,t.lineWidth=1,t.stroke(),this.drawDistance&&(t.beginPath(),t.font="15px sans-serif",t.lineWidth=3,t.strokeStyle=this.settings.strokeColor,t.strokeText(u,n-7,c+6),t.fillStyle=this.settings.distanceFillColor,t.fillText(u,n-7,c+6),t.closePath())}else{var f=i*this.cell_size+3,p=l*this.cell_size+3,v=this.cell_size-6;t.beginPath(),t.rect(f,p,v,v),t.strokeStyle=this.settings.invisibleObstructiveColor,t.lineWidth=3,t.stroke(),t.moveTo(f,p),t.lineTo(f+v,p+v),t.stroke(),t.moveTo(f+v,p),t.lineTo(f,p+v),t.stroke(),t.closePath(),this.drawDistance&&(t.beginPath(),t.font="15px sans-serif",t.strokeStyle=this.settings.invisibleObstructiveColor,t.strokeText(u,n-7,c+6),t.fillStyle=this.settings.distanceFillColor,t.fillText(u,n-7,c+6),t.closePath())}}}else{var f=i*this.cell_size+3,p=l*this.cell_size+3,v=this.cell_size-6;t.beginPath(),t.rect(f,p,v,v),t.strokeStyle=this.settings.strokeColor,t.lineWidth=1,t.stroke()}this.valid=!0}},CanvasState.prototype.getMouse=function(t){var e,s,i=this.canvas,o=0,r=0;if(void 0!==i.offsetParent)do{o+=i.offsetLeft,r+=i.offsetTop}while(i=i.offsetParent);o+=this.stylePaddingLeft+this.styleBorderLeft+this.htmlLeft,r+=this.stylePaddingTop+this.styleBorderTop+this.htmlTop,e=t.pageX-o,s=t.pageY-r;var a=$("div.los-responsive:first");return a&&(e+=a.scrollLeft()),$(".content:first")&&(s+=$(".content:first").scrollTop()),{x:e,y:s}},CanvasState.prototype.MakeGrid=function(t,e,s){var i=this.ctx;return this.width=t*e,this.height=t*s,$("#los").attr("width",t*e),$("#los").attr("height",t*s),i.strokeStyle=this.settings.gridStrokeColor,void(i.strokeWidth=.5)},CanvasState.prototype.loadMap=function(t){for(var e=0;e<t.length;e++){var s=t[e][0],i=t[e][1];0==this.matrix[s][i]&&(obstructive=new CellBlock(s*this.cell_size,i*this.cell_size,this.cell_size,this.cell_size,this.settings.obstructiveColor),obstructive.cell_x=s,obstructive.cell_y=i,this.obstructives.push(obstructive),this.matrix[s][i]=1,this.valid=!1)}},CanvasState.prototype.moveHero=function(t,e){t<this.cx&&e<this.cy&&t>=0&&e>=0&&(this.matrix[t][e]==this.settings.cellTypes.obstructive&&this.removeObstructiveBlock(t,e),this.matrix[this.hero.cell_x][this.hero.cell_y]=this.settings.cellTypes.empty,this.hero=new CellBlock(t*this.cell_size,e*this.cell_size,this.cell_size,this.cell_size),this.hero.cell_x=t,this.hero.cell_y=e,this.matrix[t][e]=this.settings.cellTypes.hero,this.hero.fill=this.settings.hero_color,this.hero.isMoving=!1,this.hero.cellType=this.settings.cellTypes.hero,this.valid=!1)},CanvasState.prototype.mouseHandler=function(t,e,s){var i=this.getMouse(t),o=Math.floor(i.x/this.cell_size),r=Math.floor(i.y/this.cell_size);switch(e){case"moveHero":this.moveHero(o,r);break;case"addObstructive":this.addObstructiveBlock(o,r,s);break;case"removeObstructive":this.removeObstructiveBlock(o,r)}},$(function(){function t(t,e){var s=document.getElementById("createur"),i=s.getContext("2d");return i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,72,72),i.translate(36,36),"left"==t?i.rotate(Math.PI/2):"bottom"==t?i.rotate(Math.PI):"right"==t&&i.rotate(3*Math.PI/2),i.fillStyle=e,i.beginPath(),i.moveTo(-36,24),i.lineTo(0,-36),i.lineTo(36,24),i.lineTo(19,24),i.lineTo(10,12),i.lineTo(10,36),i.lineTo(-10,36),i.lineTo(-10,12),i.lineTo(-19,24),i.lineTo(0,24),i.fill(),i.closePath(),s.toDataURL()}function e(t,e){var s=document.getElementById("createur"),i=s.getContext("2d");i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,72,72),i.translate(36,36);return"aleft"==t?i.rotate(Math.PI/2):"abottom"==t?i.rotate(Math.PI):"aright"==t&&i.rotate(3*Math.PI/2),i.fillStyle=e,i.fillRect(-10,-36,20,46),i.fillRect(-36,-10,46,20),s.toDataURL()}function s(t,e){var s=document.getElementById("createur"),i=s.getContext("2d");i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,72,72),i.translate(36,36),i.fillStyle=e;return"hori"==t&&i.rotate(Math.PI/2),i.fillStyle=e,i.fillRect(-10,-36,20,72),s.toDataURL()}function i(t){var e=document.getElementById("createur"),s=e.getContext("2d");s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,72,72),s.fillStyle=t;return s.translate(e.width/2,e.height/2),s.rotate(Math.PI/4),s.fillStyle=t,s.fillRect(-36,-7.5,72,15),s.fillRect(-7.5,-36,15,72),e.toDataURL()}function o(t){var e=document.getElementById("canvasKit"),s=e.getContext("2d");s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,93,93),s.translate(93,0);var i=new Image;return i.src=t,s.rotate(Math.PI/2),s.drawImage(i,0,0),e.toDataURL()}$("#tabs").tabs({heightStyle:"content"}),$("#choice_map").change(function(){$(".workflow").css("background-image","url(./img/maps/"+this.value+".png)")}),$("#dialog_enreg").dialog({height:180,width:500}).dialog("close"),$("#createur").hide(),$("#canvas").hide(),$("#canvasKit").hide(),$("#accordion").accordion({heightStyle:"content"}),$(".prototype").draggable({delay:100,appendTo:".workflow",containment:"parent",cursor:"move",scroll:!0,scrollSpeed:30,scrollSensitivity:100,helper:"clone",stop:function(t,e){$("<span class = 'jeton "+$(this)[0].classList[1]+"'>"+$(this).html()+"</span>").appendTo("body").css({position:"absolute",left:e.offset.left,top:e.offset.top,"border-color":$(this).css("borderTopColor")}).draggable({delay:100,containment:".workflow",cursor:"move",scroll:!0,scrollSpeed:30,scrollSensitivity:100,start:function(t){cs.mouseHandler(t,"removeObstructive")},stop:function(t){cs.mouseHandler(t,"addObstructive",!0)}}),cs.mouseHandler(t,"addObstructive",!0)}}),$(document).on("dblclick",".jeton",function(t){t.shiftKey?cs.mouseHandler(t,"addObstructive"):cs.mouseHandler(t,"moveHero")}),$(document).on("contextmenu",".jeton",function(t){return $(this).remove(),!1}),$("#bouton_enreg").button(),$(document).on("click","#bouton_enreg",function(t){$("#dialog_enreg").dialog("open")}),$("#bouton_valid").button(),$(document).on("click","#bouton_valid",function(t){$("#canvas").attr("width",$("#qualite").val()).attr("height",$("#qualite").val());var e=$("#qualite").val()/1196,s=document.getElementById("canvas"),i=s.getContext("2d"),o=new Image;o.src=$("#map").attr("src"),o.alt="test",i.drawImage(o,0,0,1196,1196,0,0,1196*e,1196*e),$(".jeton").each(function(){var t=new Image,s=document.getElementById("canvas"),i=s.getContext("2d"),o=$("img",this);t.src=o.attr("src");var r=o.offset(),a=$("#map").offset();"jeton kit ui-draggable"==$(this).attr("class")?(i.drawImage(t,0,0,93,93,e*(r.left-a.left),e*(r.top-a.top),93*e,93*e),$("#symC").prop("checked")&&(i.transform(-1,0,0,-1,1196*e,1196*e),i.drawImage(t,0,0,93,93,e*(r.left-a.left),e*(r.top-a.top),93*e,93*e),i.transform(1,0,0,1,0,0))):"jeton truc ui-draggable"==$(this).attr("class")?i.drawImage(t,0,0,40,40,e*(r.left-a.left),e*(r.top-a.top),40*e,40*e):i.drawImage(t,0,0,72,72,e*(r.left-a.left),e*(r.top-a.top),72*e,72*e),"jeton circle ui-draggable"==$(this).attr("class")&&(i.beginPath(),i.strokeStyle=$(this).css("borderTopColor"),i.lineWidth=8*e,i.arc(e*(r.left-a.left+36),e*(r.top-a.top+36),40*e,0,6.28),i.stroke(),i.closePath())}),s.toBlob(function(t){saveAs(t,$("#nomImage").val()+".png")})}),$("#bombe_tooltip").button(),$(document).on("click","#bombe_tooltip",function(){$("#dialog_aide").dialog("open")}),$(document).on("dblclick",".kit",function(t){1==t.which&&$(this).children("img").attr("src",o($(this).children("img").attr("src")))}),$(document).on("dblclick",".schema",function(o){if(1==o.which){if($(this).children("img").hasClass(".black"))var r="blue";if($(this).children("img").hasClass(".blue"))var r="red";if($(this).children("img").hasClass(".red"))var r="orange";if($(this).children("img").hasClass(".orange"))var r="purple";if($(this).children("img").hasClass(".purple"))var r="black";$(this).children("img").hasClass(".croix")&&$(this).children("img").attr("src",i(r)).removeClass().addClass(".croix").addClass("."+r),$(this).children("img").hasClass(".top")&&$(this).children("img").attr("src",t("top",r)).removeClass().addClass(".top").addClass("."+r),$(this).children("img").hasClass(".bottom")&&$(this).children("img").attr("src",t("bottom",r)).removeClass().addClass(".bottom").addClass("."+r),$(this).children("img").hasClass(".left")&&$(this).children("img").attr("src",t("left",r)).removeClass().addClass(".left").addClass("."+r),$(this).children("img").hasClass(".right")&&$(this).children("img").attr("src",t("right",r)).removeClass().addClass(".right").addClass("."+r),$(this).children("img").hasClass(".atop")&&$(this).children("img").attr("src",e("atop",r)).removeClass().addClass(".atop").addClass("."+r),$(this).children("img").hasClass(".abottom")&&$(this).children("img").attr("src",e("abottom",r)).removeClass().addClass(".abottom").addClass("."+r),$(this).children("img").hasClass(".aleft")&&$(this).children("img").attr("src",e("aleft",r)).removeClass().addClass(".aleft").addClass("."+r),$(this).children("img").hasClass(".aright")&&$(this).children("img").attr("src",e("aright",r)).removeClass().addClass(".aright").addClass("."+r),$(this).children("img").hasClass(".vert")&&$(this).children("img").attr("src",s("vert",r)).removeClass().addClass(".vert").addClass("."+r),$(this).children("img").hasClass(".hori")&&$(this).children("img").attr("src",s("hori",r)).removeClass().addClass(".hori").addClass("."+r)}}),$("<span class = 'prototype schema'><img src ='"+t("left","black")+"' class = '.left .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+t("right","black")+"'class = '.right .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+t("top","black")+"' class = '.top .black'></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+t("bottom","black")+"'class = '.bottom .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+e("atop","black")+"' class = '.atop .black'></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+e("aright","black")+"'class = '.aright .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+e("abottom","black")+"'class = '.abottom .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+e("aleft","black")+"' class = '.aleft .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+s("verti","black")+"' class = '.vert .black'></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+s("hori","black")+"' class = '.hori .black'></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+i("black")+"' class = '.croix .black'></span>").appendTo("#tabs-8"),$(".js-kamas-button").on("click",function(){var t=parseInt(document.querySelector(".js-kamas-counter").innerHTML,10);return $(this).is(".js-kamas-plus")?t++:t>0&&t--,document.querySelector(".js-kamas-counter").innerHTML=t,!1}),Start(),$(".js-move-hero").on("click",function(){moveHero()}),$(".js-toggle-distance").on("click",function(){toggleDistance()}),$(".js-clear-los").on("click",function(){clearSight()}),$(".js-load-map").on("click",function(){loadMap($("#choice_map option:selected").val())}),$(".js-enable-los").on("click",function(){toggleInvisible()})});