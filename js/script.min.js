function lineIntersect2(t,e,s,i,a,o,n,r){var l=((t*i-e*s)*(a-n)-(t-s)*(a*r-o*n))/((t-s)*(o-r)-(e-i)*(a-n)),c=((t*i-e*s)*(o-r)-(e-i)*(a*r-o*n))/((t-s)*(o-r)-(e-i)*(a-n));if(isNaN(l)||isNaN(c))return!1;if(t>=s){if(!(s<=l&&l<=t))return!1}else if(!(t<=l&&l<=s))return!1;if(e>=i){if(!(i<=c&&c<=e))return!1}else if(!(e<=c&&c<=i))return!1;if(a>=n){if(!(n<=l&&l<=a))return!1}else if(!(a<=l&&l<=n))return!1;if(o>=r){if(!(r<=c&&c<=o))return!1}else if(!(o<=c&&c<=r))return!1;return!0}function lineIntersect(t,e,s,i,a,o,n,r){var l=((t*i-e*s)*(a-n)-(t-s)*(a*r-o*n))/((t-s)*(o-r)-(e-i)*(a-n)),c=((t*i-e*s)*(o-r)-(e-i)*(a*r-o*n))/((t-s)*(o-r)-(e-i)*(a-n));if(isNaN(l)||isNaN(c))return!1;if(t>=s){if(!(s<=l&&l<=t))return!1}else if(!(t<=l&&l<=s))return!1;if(e>=i){if(!(i<=c&&c<=e))return!1}else if(!(e<=c&&c<=i))return!1;if(a>=n){if(!(n<=l&&l<=a))return!1}else if(!(a<=l&&l<=n))return!1;if(o>=r){if(!(r<=c&&c<=o))return!1}else if(!(o<=c&&c<=r))return!1;return!0}function CellBlock(t,e,s,i,a){this.x=t||0,this.y=e||0,this.w=s||1,this.h=i||1,this.fill=a||"#ce3b55",this.cell_x=-1,this.cell_y=-1,this.isHero=!1}function CanvasState(t,e,s,i){this.cell_size=e,this.cx=s,this.cy=i,this.matrix=new Array(s);for(var a=0;a<s;a++){this.matrix[a]=new Array(i);for(var o=0;o<i;o++)this.matrix[a][o]=0}this.drawDistance=!1,this.hero=new CellBlock(Math.floor(s/2)*this.cell_size,(i-1)*this.cell_size,this.cell_size,this.cell_size),this.hero.cell_x=Math.floor(s/2),this.hero.cell_y=i-1,this.matrix[Math.floor(s/2)][i-1]=2,this.hero.fill="#00FF00",this.hero.isMoving=!1,this.hero.isHero=!0,this.canvas=t,this.width=t.width,this.height=t.height,this.ctx=t.getContext("2d");document.defaultView&&document.defaultView.getComputedStyle&&(this.stylePaddingLeft=parseInt(document.defaultView.getComputedStyle(t,null).paddingLeft,10)||0,this.stylePaddingTop=parseInt(document.defaultView.getComputedStyle(t,null).paddingTop,10)||0,this.styleBorderLeft=parseInt(document.defaultView.getComputedStyle(t,null).borderLeftWidth,10)||0,this.styleBorderTop=parseInt(document.defaultView.getComputedStyle(t,null).borderTopWidth,10)||0);var n=document.body.parentNode;this.htmlTop=n.offsetTop,this.htmlLeft=n.offsetLeft,this.valid=!1,this.shapes=[],this.dragging=!1,this.selection=null,this.dragoffx=0,this.dragoffy=0;var r=this;t.addEventListener("selectstart",function(t){return t.preventDefault(),!1},!1),t.addEventListener("mousedown",function(t){var e=r.getMouse(t);e.x,e.y;r.addShapeBlock(e)},!0),this.selectionColor="#CC0000",this.selectionWidth=2,this.interval=30,setInterval(function(){r.draw()},r.interval)}function Start(){cs=new CanvasState(document.getElementById("cnv"),69,12,12)}function clearSight(){cs?cs.resetShapes():Start()}function showDistance(t){cs&&(cs.drawDistance=t,cs.valid=!1)}function toggleDistance(){cs&&(cs.drawDistance=!cs.drawDistance,cs.valid=!1)}function moveHero(){cs.hero.isMoving=!0}function loadMap(t){maps_shapes[t]&&cs.loadMap(maps_shapes[t])}("function"!=typeof Blob&&"object"!=typeof Blob||"undefined"==typeof URL)&&(self.Blob=function(t){"use strict";t.URL=t.URL||t.webkitURL;var e=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder||function(t){var e=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},s=function(){this.data=[]},i=function(t,e,s){this.data=t,this.size=t.length,this.type=e,this.encoding=s},a=s.prototype,o=i.prototype,n=t.FileReaderSync,r=function(t){this.code=this[this.name=t]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=l.length,h=t.URL||t.webkitURL||t,d=h.createObjectURL,f=h.revokeObjectURL,p=h,u=t.btoa,g=t.atob,m=t.ArrayBuffer,v=t.Uint8Array;for(i.fake=o.fake=!0;c--;)r.prototype[l[c]]=c+1;return h.createObjectURL||(p=t.URL={}),p.createObjectURL=function(t){var e,s=t.type;return null===s&&(s="application/octet-stream"),t instanceof i?(e="data:"+s,"base64"===t.encoding?e+";base64,"+t.data:"URI"===t.encoding?e+","+decodeURIComponent(t.data):u?e+";base64,"+u(t.data):e+","+encodeURIComponent(t.data)):d?d.call(h,t):void 0},p.revokeObjectURL=function(t){"data:"!==t.substring(0,5)&&f&&f.call(h,t)},a.append=function(t){var s=this.data;if(v&&(t instanceof m||t instanceof v)){for(var a="",o=new v(t),l=0,c=o.length;l<c;l++)a+=String.fromCharCode(o[l]);s.push(a)}else if("Blob"===e(t)||"File"===e(t)){if(!n)throw new r("NOT_READABLE_ERR");var h=new n;s.push(h.readAsBinaryString(t))}else t instanceof i?"base64"===t.encoding&&g?s.push(g(t.data)):"URI"===t.encoding?s.push(decodeURIComponent(t.data)):"raw"===t.encoding&&s.push(t.data):("string"!=typeof t&&(t+=""),s.push(unescape(encodeURIComponent(t))))},a.getBlob=function(t){return arguments.length||(t=null),new i(this.data.join(""),t,"raw")},a.toString=function(){return"[object BlobBuilder]"},o.slice=function(t,e,s){var a=arguments.length;return a<3&&(s=null),new i(this.data.slice(t,a>1?e:this.data.length),s,this.encoding)},o.toString=function(){return"[object Blob]"},s}(t);return function(t,s){var i=s?s.type||"":"",a=new e;if(t)for(var o=0,n=t.length;o<n;o++)a.append(t[o]);return a.getBlob(i)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this)),function(t){"use strict";var e,s=t.Uint8Array,i=t.HTMLCanvasElement,a=i&&i.prototype,o=/\s*;\s*base64\s*(?:;|$)/i,n="toDataURL",r=function(t){for(var i,a,o=t.length,n=new s(o/4*3|0),r=0,l=0,c=[0,0],h=0,d=0;o--;)a=t.charCodeAt(r++),255!==(i=e[a-43])&&void 0!==i&&(c[1]=c[0],c[0]=a,d=d<<6|i,4===++h&&(n[l++]=d>>>16,61!==c[1]&&(n[l++]=d>>>8),61!==c[0]&&(n[l++]=d),h=0));return n};s&&(e=new s([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),i&&!a.toBlob&&(a.toBlob=function(t,e){if(e||(e="image/png"),this.mozGetAsFile)return void t(this.mozGetAsFile("canvas",e));var i,a=Array.prototype.slice.call(arguments,1),l=this[n].apply(this,a),c=l.indexOf(","),h=l.substring(c+1),d=o.test(l.substring(0,c));Blob.fake?(i=new Blob,i.encoding=d?"base64":"URI",i.data=h,i.size=h.length):s&&(i=d?new Blob([r(h)],{type:e}):new Blob([decodeURIComponent(h)],{type:e})),t(i)},a.toDataURLHD?a.toBlobHD=function(){n="toDataURLHD";var t=this.toBlob();return n="toDataURL",t}:a.toBlobHD=a.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,s=function(){return t.URL||t.webkitURL||t},i=t.URL||t.webkitURL||t,a=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o=!t.externalHost&&"download"in a,n=t.webkitRequestFileSystem,r=t.requestFileSystem||n||t.mozRequestFileSystem,l=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},c=0,h=[],d=function(){for(var t=h.length;t--;){var e=h[t];"string"==typeof e?i.revokeObjectURL(e):e.remove()}h.length=0},f=function(t,e,s){e=[].concat(e);for(var i=e.length;i--;){var a=t["on"+e[i]];if("function"==typeof a)try{a.call(t,s||t)}catch(t){l(t)}}},p=function(i,l){var d,p,u,g=this,m=i.type,v=!1,b=function(){var t=s().createObjectURL(i);return h.push(t),t},y=function(){f(g,"writestart progress write writeend".split(" "))},w=function(){!v&&d||(d=b()),p?p.location.href=d:window.open(d,"_blank"),g.readyState=g.DONE,y()},C=function(t){return function(){if(g.readyState!==g.DONE)return t.apply(this,arguments)}},$={create:!0,exclusive:!1};if(g.readyState=g.INIT,l||(l="download"),o){d=b(),e=t.document,a=e.createElementNS("http://www.w3.org/1999/xhtml","a"),a.href=d,a.download=l;var k=e.createEvent("MouseEvents");return k.initMouseEvent("click",!0,!1,t,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(k),g.readyState=g.DONE,void y()}if(t.chrome&&m&&"application/octet-stream"!==m&&(u=i.slice||i.webkitSlice,i=u.call(i,0,i.size,"application/octet-stream"),v=!0),n&&"download"!==l&&(l+=".download"),("application/octet-stream"===m||n)&&(p=t),!r)return void w();c+=i.size,r(t.TEMPORARY,c,C(function(t){t.root.getDirectory("saved",$,C(function(t){var e=function(){t.getFile(l,$,C(function(t){t.createWriter(C(function(e){e.onwriteend=function(e){p.location.href=t.toURL(),h.push(t),g.readyState=g.DONE,f(g,"writeend",e)},e.onerror=function(){var t=e.error;t.code!==t.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(t){e["on"+t]=g["on"+t]}),e.write(i),g.abort=function(){e.abort(),g.readyState=g.DONE},g.readyState=g.WRITING}),w)}),w)};t.getFile(l,{create:!1},C(function(t){t.remove(),e()}),C(function(t){t.code===t.NOT_FOUND_ERR?e():w()}))}),w)}),w)},u=p.prototype,g=function(t,e){return new p(t,e)};return u.abort=function(){var t=this;t.readyState=t.DONE,f(t,"abort")},u.readyState=u.INIT=0,u.WRITING=1,u.DONE=2,u.error=u.onwritestart=u.onprogress=u.onwrite=u.onabort=u.onerror=u.onwriteend=null,t.addEventListener("unload",d,!1),g.unload=function(){d(),t.removeEventListener("unload",d,!1)},g}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs});var cs=null,maps_shapes={bonta1:[[3,3],[10,4],[6,5],[5,6],[1,7],[8,8]],bonta1_tapped:[[4,1],[8,3],[7,10],[3,8],[6,6],[5,5]],bonta2:[[3,2],[6,3],[9,5],[8,9],[5,8],[2,6]],bonta2_tapped:[[5,2],[9,3],[8,6],[3,5],[2,8],[6,9]]};CellBlock.prototype.draw=function(t){if(this.isHero){t.beginPath();var e=t.lineWidth,s=t.strokeStyle;t.lineWidth=6,t.strokeStyle="#0080ff",t.arc(this.x+Math.floor(this.w/2),this.y+Math.floor(this.h/2),Math.floor(this.w/2)-3,0,2*Math.PI,!1),t.stroke(),t.lineWidth=e,t.strokeStyle=s,t.closePath()}else t.fillStyle=this.fill,t.fillRect(this.x,this.y,this.w,this.h)},CellBlock.prototype.intersectLine=function(t,e,s,i){var a=this.x+1,o=this.y+1,n=this.w-2,r=this.h-2,l=lineIntersect(a,o,a+n,o,t,e,s,i),c=lineIntersect(a,o,a,o+r,t,e,s,i),h=lineIntersect(a+n,o,a+n,o+r,t,e,s,i),d=lineIntersect(a,o+r,a+n,o+r,t,e,s,i);return l||c||h||d},CellBlock.prototype.contains=function(t,e){return this.x<=t&&this.x+this.w>=t&&this.y<=e&&this.y+this.h>=e},CanvasState.prototype.resetShapes=function(){for(var t=this.shapes.length,e=t-1;e>=0;e--)this.matrix[this.shapes[e].cell_x][this.shapes[e].cell_y]=0,this.shapes.splice(e,1);this.valid=!1},CanvasState.prototype.addShapeBlock=function(t){var e=Math.floor(t.x/this.cell_size),s=Math.floor(t.y/this.cell_size);if(console.log(e,s),1==this.matrix[e][s]){for(var i=this.shapes.length,a=i-1;a>=0;a--)if(this.shapes[a].contains(t.x,t.y))return this.matrix[this.shapes[a].cell_x][this.shapes[a].cell_y]=0,this.shapes.splice(a,1),void(this.valid=!1)}else 0==this.matrix[e][s]&&(this.hero.isMoving?(this.matrix[this.hero.cell_x][this.hero.cell_y]=0,this.hero=new CellBlock(e*this.cell_size,s*this.cell_size,this.cell_size,this.cell_size),this.hero.cell_x=e,this.hero.cell_y=s,this.matrix[e][s]=2,this.hero.fill="#00FF00",this.hero.isMoving=!1,this.hero.isHero=!0,this.valid=!1):(shape=new CellBlock(e*this.cell_size,s*this.cell_size,this.cell_size,this.cell_size,"rgba(206,59,85,0.5)"),shape.cell_x=e,shape.cell_y=s,this.shapes.push(shape),this.matrix[e][s]=1,this.valid=!1))},CanvasState.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},CanvasState.prototype.draw=function(){if(!this.valid){var t=this.ctx,e=this.shapes;this.clear(),this.MakeGrid(this.cell_size,this.cx,this.cy);for(var s=e.length,i=0;i<s;i++){var a=e[i];a.x>this.width||a.y>this.height||a.x+a.w<0||a.y+a.h<0||e[i].draw(t)}this.hero.draw(t);for(var o=this.hero.x+Math.floor(this.hero.w/2),n=this.hero.y+Math.floor(this.hero.h/2),i=0;i<this.cx;i++)for(var r=0;r<this.cy;r++)if(0==this.matrix[i][r]){for(var l=i*this.cell_size+Math.floor(this.cell_size/2),c=r*this.cell_size+Math.floor(this.cell_size/2),h=e.length,d=!1,h=0;h<s;h++)d=d||e[h].intersectLine(o,n,l,c);var f=Math.abs(this.hero.cell_x-i)+Math.abs(this.hero.cell_y-r);if(d){var p=i*this.cell_size+3,u=r*this.cell_size+3,g=this.cell_size-6;t.beginPath(),t.rect(p,u,g,g),t.strokeStyle="#F3AC3F",t.lineWidth=3,t.stroke(),t.moveTo(p,u),t.lineTo(p+g,u+g),t.stroke(),t.moveTo(p+g,u),t.lineTo(p,u+g),t.stroke(),t.closePath(),this.drawDistance&&(t.beginPath(),t.font="15px sans-serif",t.strokeStyle="#F3AC3F",t.strokeText(f,l-7,c+6),t.fillStyle="#FFFFFF",t.fillText(f,l-7,c+6),t.closePath())}else{var p=i*this.cell_size+3,u=r*this.cell_size+3,g=this.cell_size-6;t.beginPath(),t.rect(p,u,g,g),t.strokeStyle="#2AAE61",t.lineWidth=1,t.stroke(),this.drawDistance&&(t.beginPath(),t.font="15px sans-serif",t.lineWidth=3,t.strokeStyle="#2AAE61",t.strokeText(f,l-7,c+6),t.fillStyle="#FFFFFF",t.fillText(f,l-7,c+6),t.closePath())}}this.valid=!0}},CanvasState.prototype.getMouse=function(t){var e,s,i=this.canvas,a=0,o=0;if(void 0!==i.offsetParent)do{a+=i.offsetLeft,o+=i.offsetTop}while(i=i.offsetParent);a+=this.stylePaddingLeft+this.styleBorderLeft+this.htmlLeft,o+=this.stylePaddingTop+this.styleBorderTop+this.htmlTop,e=t.pageX-a,s=t.pageY-o;var n=$("div.los-responsive:first");return n&&(e+=n.scrollLeft()),$(".content:first")&&(s+=$(".content:first").scrollTop()),{x:e,y:s}},CanvasState.prototype.MakeGrid=function(t,e,s){var i=this.ctx;return this.width=t*e,this.height=t*s,$("#cnv").attr("width",t*e),$("#cnv").attr("height",t*s),$("#divcnv").attr("width",t*e),$("#divcnv").attr("height",t*s),i.strokeStyle="#cccccc",void(i.strokeWidth=.5)},CanvasState.prototype.loadMap=function(t){for(var e=0;e<t.length;e++){var s=t[e][0],i=t[e][1];shape=new CellBlock(s*this.cell_size,i*this.cell_size,this.cell_size,this.cell_size,"rgba(206,59,85,0.5)"),shape.cell_x=s,shape.cell_y=i,this.shapes.push(shape),this.matrix[s][i]=1,this.valid=!1}},$(function(){function t(t,e){var s=document.getElementById("createur"),i=s.getContext("2d");return i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,72,72),i.translate(36,36),"left"==t?i.rotate(Math.PI/2):"bottom"==t?i.rotate(Math.PI):"right"==t&&i.rotate(3*Math.PI/2),i.fillStyle=e,i.beginPath(),i.moveTo(-36,24),i.lineTo(0,-36),i.lineTo(36,24),i.lineTo(19,24),i.lineTo(10,12),i.lineTo(10,36),i.lineTo(-10,36),i.lineTo(-10,12),i.lineTo(-19,24),i.lineTo(0,24),i.fill(),i.closePath(),s.toDataURL()}function e(t,e){var s=document.getElementById("createur"),i=s.getContext("2d");i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,72,72),i.translate(36,36);return"aleft"==t?i.rotate(Math.PI/2):"abottom"==t?i.rotate(Math.PI):"aright"==t&&i.rotate(3*Math.PI/2),i.fillStyle=e,i.fillRect(-10,-36,20,46),i.fillRect(-36,-10,46,20),s.toDataURL()}function s(t,e){var s=document.getElementById("createur"),i=s.getContext("2d");i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,72,72),i.translate(36,36),i.fillStyle=e;return"hori"==t&&i.rotate(Math.PI/2),i.fillStyle=e,i.fillRect(-10,-36,20,72),s.toDataURL()}function i(t){var e=document.getElementById("createur"),s=e.getContext("2d");s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,72,72),s.fillStyle=t;return s.translate(e.width/2,e.height/2),s.rotate(Math.PI/4),s.fillStyle=t,s.fillRect(-36,-7.5,72,15),s.fillRect(-7.5,-36,15,72),e.toDataURL()}function a(t){var e=document.getElementById("canvasKit"),s=e.getContext("2d");s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,93,93),s.translate(93,0);var i=new Image;return i.src=t,s.rotate(Math.PI/2),s.drawImage(i,0,0),e.toDataURL()}$("#tabs").tabs({heightStyle:"content"}),$("#choice_map").change(function(){$(".workflow").css("background-image","url(./img/maps/"+this.value+".png)")}),$("#dialog_enreg").dialog({height:180,width:500}).dialog("close"),$("#createur").hide(),$("#canvas").hide(),$("#canvasKit").hide(),$("#accordion").accordion({heightStyle:"content"}),$(".prototype").draggable({delay:100,appendTo:"body",containment:"parent",cursor:"move",scroll:!0,scrollSpeed:30,scrollSensitivity:100,helper:"clone",stop:function(t,e){$("<span class = 'jeton "+$(this)[0].classList[1]+"'>"+$(this).html()+"</span>").appendTo("body").css({position:"absolute",left:e.offset.left,top:e.offset.top,"border-color":$(this).css("borderTopColor")}).draggable({delay:100,containment:"parent",cursor:"move",scroll:!0,scrollSpeed:30,scrollSensitivity:100})}}),$(document).on("dblclick",".circle",function(t){if(1==t.which){var e={"rgb(0, 0, 0)":"blue","rgb(0, 0, 255)":"red","rgb(255, 0, 0)":"orange","rgb(255, 165, 0)":"purple","rgb(128, 0, 128)":"black"};$(this).css("border-color",e[$(this).css("borderTopColor")])}}),$(document).on("contextmenu",".jeton",function(t){return $(this).remove(),!1}),$("#bouton_enreg").button(),$(document).on("click","#bouton_enreg",function(t){$("#dialog_enreg").dialog("open")}),$("#bouton_valid").button(),$(document).on("click","#bouton_valid",function(t){$("#canvas").attr("width",$("#qualite").val()).attr("height",$("#qualite").val());var e=$("#qualite").val()/1196,s=document.getElementById("canvas"),i=s.getContext("2d"),a=new Image;a.src=$("#map").attr("src"),a.alt="test",i.drawImage(a,0,0,1196,1196,0,0,1196*e,1196*e),$(".jeton").each(function(){var t=new Image,s=document.getElementById("canvas"),i=s.getContext("2d"),a=$("img",this);t.src=a.attr("src");var o=a.offset(),n=$("#map").offset();"jeton kit ui-draggable"==$(this).attr("class")?(i.drawImage(t,0,0,93,93,e*(o.left-n.left),e*(o.top-n.top),93*e,93*e),$("#symC").prop("checked")&&(i.transform(-1,0,0,-1,1196*e,1196*e),i.drawImage(t,0,0,93,93,e*(o.left-n.left),e*(o.top-n.top),93*e,93*e),i.transform(1,0,0,1,0,0))):"jeton truc ui-draggable"==$(this).attr("class")?i.drawImage(t,0,0,40,40,e*(o.left-n.left),e*(o.top-n.top),40*e,40*e):i.drawImage(t,0,0,72,72,e*(o.left-n.left),e*(o.top-n.top),72*e,72*e),"jeton circle ui-draggable"==$(this).attr("class")&&(i.beginPath(),i.strokeStyle=$(this).css("borderTopColor"),i.lineWidth=8*e,i.arc(e*(o.left-n.left+36),e*(o.top-n.top+36),40*e,0,6.28),i.stroke(),i.closePath())}),s.toBlob(function(t){saveAs(t,$("#nomImage").val()+".png")})}),$("#bombe_tooltip").button(),$(document).on("click","#bombe_tooltip",function(){$("#dialog_aide").dialog("open")}),$(document).on("dblclick",".kit",function(t){1==t.which&&$(this).children("img").attr("src",a($(this).children("img").attr("src")))}),$(document).on("dblclick",".schema",function(a){if(1==a.which){if($(this).children("img").hasClass(".black"))var o="blue";if($(this).children("img").hasClass(".blue"))var o="red";if($(this).children("img").hasClass(".red"))var o="orange";if($(this).children("img").hasClass(".orange"))var o="purple";if($(this).children("img").hasClass(".purple"))var o="black";$(this).children("img").hasClass(".croix")&&$(this).children("img").attr("src",i(o)).removeClass().addClass(".croix").addClass("."+o),$(this).children("img").hasClass(".top")&&$(this).children("img").attr("src",t("top",o)).removeClass().addClass(".top").addClass("."+o),$(this).children("img").hasClass(".bottom")&&$(this).children("img").attr("src",t("bottom",o)).removeClass().addClass(".bottom").addClass("."+o),$(this).children("img").hasClass(".left")&&$(this).children("img").attr("src",t("left",o)).removeClass().addClass(".left").addClass("."+o),$(this).children("img").hasClass(".right")&&$(this).children("img").attr("src",t("right",o)).removeClass().addClass(".right").addClass("."+o),$(this).children("img").hasClass(".atop")&&$(this).children("img").attr("src",e("atop",o)).removeClass().addClass(".atop").addClass("."+o),$(this).children("img").hasClass(".abottom")&&$(this).children("img").attr("src",e("abottom",o)).removeClass().addClass(".abottom").addClass("."+o),$(this).children("img").hasClass(".aleft")&&$(this).children("img").attr("src",e("aleft",o)).removeClass().addClass(".aleft").addClass("."+o),$(this).children("img").hasClass(".aright")&&$(this).children("img").attr("src",e("aright",o)).removeClass().addClass(".aright").addClass("."+o),$(this).children("img").hasClass(".vert")&&$(this).children("img").attr("src",s("vert",o)).removeClass().addClass(".vert").addClass("."+o),$(this).children("img").hasClass(".hori")&&$(this).children("img").attr("src",s("hori",o)).removeClass().addClass(".hori").addClass("."+o)}}),$("<span class = 'prototype schema'><img src ='"+t("left","black")+"' class = '.left .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+t("right","black")+"'class = '.right .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+t("top","black")+"' class = '.top .black'></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+t("bottom","black")+"'class = '.bottom .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+e("atop","black")+"' class = '.atop .black'></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+e("aright","black")+"'class = '.aright .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+e("abottom","black")+"'class = '.abottom .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+e("aleft","black")+"' class = '.aleft .black' ></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+s("verti","black")+"' class = '.vert .black'></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+s("hori","black")+"' class = '.hori .black'></span>").appendTo("#tabs-8"),$("<span class = 'prototype schema'><img src ='"+i("black")+"' class = '.croix .black'></span>").appendTo("#tabs-8"),$(".js-kamas-button").on("click",function(){var t=parseInt(document.querySelector(".js-kamas-counter").innerHTML,10);return $(this).is(".js-kamas-plus")?t++:t>0&&t--,document.querySelector(".js-kamas-counter").innerHTML=t,!1}),Start(),$(".js-move-hero").on("click",function(){moveHero()}),$(".js-toggle-distance").on("click",function(){toggleDistance()}),$(".js-clear-los").on("click",function(){clearSight()}),$(".js-load-map").on("click",function(){loadMap($("#choice_map option:selected").val())})});